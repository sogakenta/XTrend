# XTrend タスクリスト

最終更新: 2026-02-17

---

## 凡例

| ステータス | 意味 |
|-----------|------|
| ✅ | 完了 |
| 🚧 | 進行中 |
| 📋 | 予定（未着手） |
| 🔍 | 検討中（要判断） |
| ⏸️ | 保留 |

---

## Phase 0: 緊急対応（正しさの問題）

| # | タスク | ステータス | 備考 |
|---|--------|-----------|------|
| P0-1 | rankChangeの時点固定 | ✅ | `resolveCapturedAt()`で実装 |
| P0-2 | durationHoursの連続判定修正 | ✅ | gap検出ロジック実装 |
| P0-3 | regionCountの時点固定 | ✅ | 範囲クエリ→同一captured_at |

---

## Phase 1: 即時最適化

| # | タスク | ステータス | 備考 |
|---|--------|-----------|------|
| P1-1 | revalidate=600に変更 | ✅ | page.tsx, place/[slug]/page.tsx |
| P1-2 | offsetのプリセット制限 | ✅ | 不正値はリダイレクト |
| P1-3 | TimeOffsetTabsに48h/72h追加 | ✅ | lib/constants.tsに分離 |

---

## Phase 2: シグナル事前計算（中期）

| # | タスク | ステータス | 備考 |
|---|--------|-----------|------|
| P2-1 | trend_signal_hourlyテーブル設計 | 📋 | スキーマはdocs/002に記載済み |
| P2-2 | compute_signals SQL/RPC実装 | 📋 | |
| P2-3 | ingest連携（バッチ完了後に計算） | 📋 | |
| P2-4 | Web側をJOINクエリに変更 | 📋 | |
| P2-5 | バックフィル（既存データへのシグナル計算） | 📋 | |

---

## Phase 3: On-Demand Revalidation（長期）

| # | タスク | ステータス | 備考 |
|---|--------|-----------|------|
| P3-1 | /api/revalidate エンドポイント実装 | 📋 | 設計はdocs/003に記載済み |
| P3-2 | Batch側のtriggerRevalidate実装 | 📋 | |
| P3-3 | 署名検証（HMAC-SHA256） | 📋 | |
| P3-4 | 環境変数設定（REVALIDATE_SECRET） | 📋 | |

---

## 検討中の項目

| # | 項目 | ステータス | 検討内容 |
|---|------|-----------|---------|
| D-1 | Web本番環境 | 🔍 | Vercel or Cloud Run？ |
| D-2 | Cloud Runインスタンス数 | 🔍 | 複数の場合は共有cache handler必要 |
| D-3 | /termページの再検証 | 🔍 | 初期は対象外を推奨 |
| D-4 | 更新頻度（30分更新） | 🔍 | X API Basicプラン範囲内で可能 |

---

## 見送り事項

| 項目 | 理由 |
|------|------|
| DB移行（Neon等） | 今の課題はDB製品ではない |
| マテリアライズドビュー | 53地域でrefreshコスト問題 |
| 完全SSG | 動的ページ運用を切る判断が必要 |
| 全シグナル一括実装 | まず最小差別化で検証 |

---

## 直近の完了履歴

| 日付 | コミット | 内容 |
|------|---------|------|
| 2026-02-17 | 43b0bdc | シグナル計算の時点固定とISR設定最適化 |
| 2026-02-16 | e38acf7 | アーキテクチャ根本レビュー追加 |
| 2026-02-16 | cca01cf | On-Demand Revalidation 設計ドキュメント追加 |
| 2026-02-16 | 6336bbe | DB負荷対策の設計ドキュメント追加 |
| 2026-02-16 | b6c1443 | トレンドシグナル機能の設計ドキュメント追加 |

---

## 関連ドキュメント

- [統合仕様書](./2026-02-17-001-integrated-spec.md)
- [トレンドシグナル機能設計](./2026-02-16-001-trend-signals-design.md)
- [DB負荷対策設計](./2026-02-16-002-db-optimization-design.md)
- [On-Demand Revalidation設計](./2026-02-16-003-on-demand-revalidation.md)
- [アーキテクチャ根本レビュー](./2026-02-16-004-architecture-review.md)
